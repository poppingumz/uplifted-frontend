stages:
  - end2end-test

end2end-test:
  stage: end2end-test
  tags:
    - pwsh
  script:
    # Build backend image
    - docker build -t uplifted-backend "C:\Projects\uplifted-learning-platform"

    # Run backend container
    - docker run -d --rm `
        --name uplifted-backend `
        -p 8080:8080 `
        uplifted-backend

    # Build frontend image
    - docker build -t uplifted-frontend `
        --build-arg VITE_API_URL=http://localhost:8080 `
        "C:\Projects\uplifted-frontend"

    # Run frontend container
    - docker run -d --rm `
        --name uplifted-frontend `
        -p 5173:80 `
        uplifted-frontend

    # Wait for backend and frontend to be fully started
    - Start-Sleep -Seconds 20

    # Run Cypress tests locally
    - cd "C:\Projects\uplifted-frontend"
    - npm install
    - npx cypress install
    - npx cypress run
